<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Exploratory Data Analysis Using Random Forests. edarf</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container">
      <header><div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">edarf</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Exploratory Data Analysis Using Random Forests</h1>
                        <h4 class="author">Zachary M. Jones and Fridolin Linder</h4>
            
            <h4 class="date">2016-10-13</h4>
          </div>

    
    
<p>This package allows you to compute the partial dependence of an arbitrarily large set of covariates, compute local, aggregate, and class-specific variable importance, and case/observation-level distance between data points given a fitted random forest from the following packages (outcome variable types supported in parenthesis): <a href="https://cran.r-project.org/package=party">party</a> (multivariate, regression, and classification), <a href="https://cran.r-project.org/package=randomForestSRC">randomForestSRC</a> (regression, classification, and survival), and <a href="https://cran.r-project.org/package=randomForest">randomForest</a> (regression and classification).</p>
<p>The function <code>partial_dependence</code> outputs a <code>data.frame</code> of class <code>pd</code>. By default all of the supported random forest classifiers will return predictions on the response scale, in this case class labels. However, we can use the <code>type</code> argument to instead return class probabilities, in this case the proportion of times a particular observation was classified as belonging to a certain class across all trees in the forest.</p>
<p>The <code>var</code> argument is a character vector which gives the features for which the partial dependence is desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(edarf)

<span class="kw">data</span>(iris)
<span class="kw">library</span>(randomForest)
fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Species ~<span class="st"> </span>., iris)
pd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial_dependence.html">partial_dependence</a></span>(fit, <span class="dt">data =</span> iris, <span class="dt">var =</span> <span class="st">"Petal.Width"</span>)
<span class="kw">print</span>(pd)</code></pre></div>
<pre><code>##       setosa versicolor virginica Petal.Width
## 1  0.6350933  0.2407733 0.1241333   0.1000000
## 2  0.6350933  0.2407733 0.1241333   0.3666667
## 3  0.6328533  0.2430133 0.1241333   0.6333333
## 4  0.1676000  0.6089867 0.2234133   0.9000000
## 5  0.1652267  0.6113600 0.2234133   1.1666667
## 6  0.1652133  0.5959200 0.2388667   1.4333333
## 7  0.1629467  0.4410133 0.3960400   1.7000000
## 8  0.1587067  0.2162000 0.6250933   1.9666667
## 9  0.1587067  0.2149200 0.6263733   2.2333333
## 10 0.1587067  0.2149200 0.6263733   2.5000000</code></pre>
<p>The number of output rows is controlled by <code>cutoff</code>, which by default is 10. This controls the number of points in the prediction grid that are evaluated. That is, the number of unique values of the variable indicated by the <code>var</code> argument for which the partial dependence of the learned function is evaluated.</p>
<p>Output from <code>partial_dependence</code> can be visualized using <code>plot_pd</code>, which uses <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> to create simple but (hopefully) effective visualizations. In this simple case a line plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_pd.html">plot_pd</a></span>(pd)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p><code>partial_dependence</code> can be run in parallel by registering the appropriate parallel backend using <a href="https://cran.r-project.org/package=doParallel">doParallel</a>.</p>
<p>The <code>partial_dependence</code> method can also either return interactions (the partial dependence on unique combinations of a subset of the feature space) or a list of bivariate partial dependence estimates (when multiple features are specified in <code>var</code> but <code>interaction = FALSE</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pd_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial_dependence.html">partial_dependence</a></span>(fit, <span class="dt">data =</span> iris, <span class="kw">c</span>(<span class="st">"Petal.Width"</span>, <span class="st">"Petal.Length"</span>), <span class="dt">interaction =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/plot_pd.html">plot_pd</a></span>(pd_list)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pd_int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial_dependence.html">partial_dependence</a></span>(fit, <span class="dt">data =</span> iris, <span class="kw">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>), <span class="dt">interaction =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/plot_pd.html">plot_pd</a></span>(pd_int, <span class="dt">facet =</span> <span class="st">"Sepal.Width"</span>)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>When an interaction is computed the <code>facet</code> argument is used to construct plots wheren the feature not set to be the facet is shown conditional on a particular value of the <code>facet</code> feature. This works best when said feature is an integer or a factor.</p>
<p><code>variable_importance</code> can be used to compute the local, joint, or aggregate permutation importance of covariates. A particular covariate, or covariates, as specified by the <code>var</code> parameter, are randomly shuffled, and predictions are computed. Aggregate variable importance is the mean difference between the unpermuted predictions and the predictions made when the covariates specified in <code>var</code> are permuted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_importance.html">variable_importance</a></span>(fit, <span class="dt">var =</span> <span class="kw">colnames</span>(iris)[-<span class="dv">5</span>],
  <span class="dt">type =</span> <span class="st">"aggregate"</span>, <span class="dt">nperm =</span> <span class="dv">2</span>, <span class="dt">data =</span> iris)
<span class="kw"><a href="../reference/plot_imp.html">plot_imp</a></span>(imp)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>If <code>type = "local"</code> instead the differences between the permuted predictions and the unpermuted predictions are averaged for each data point, rather than over all of the sample data. For classification problems this allows us ot compute a class specific measure of variable importance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imp_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_importance.html">variable_importance</a></span>(fit, <span class="dt">var =</span> <span class="kw">colnames</span>(iris)[-<span class="dv">5</span>],
  <span class="dt">type =</span> <span class="st">"local"</span>, <span class="dt">nperm =</span> <span class="dv">2</span>, <span class="dt">data =</span> iris)
<span class="kw"><a href="../reference/plot_imp.html">plot_imp</a></span>(imp_class)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>In the case of a continuous outcome variable this importance measure can be smoothed to show the importance of the covariate(s) to different points in the distribution of the outcome variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Fertility ~<span class="st"> </span>., <span class="dt">data =</span> swiss, <span class="dt">proximity =</span> <span class="ot">TRUE</span>)
imp_local &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_importance.html">variable_importance</a></span>(fit, <span class="dt">var =</span> <span class="kw">colnames</span>(swiss)[-<span class="dv">1</span>], <span class="dt">type =</span> <span class="st">"local"</span>,
  <span class="dt">data =</span> swiss)
<span class="kw"><a href="../reference/plot_imp.html">plot_imp</a></span>(imp_local)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>If multiple variables are passed to the <code>var</code> argument and <code>interaction = TRUE</code> then the difference in the error induced by permuting all the variables in <code>var</code>, versus the error induced by permuting each element of <code>var</code> separately, is computed.</p>
<p><code>extract_proximity</code> extracts or computes a matrix which gives the co-occurence of data points in the terminal nodes of the trees in the fitted random forest. This can be used to visualize the distance between data points in the model.</p>
<p>This matrix is too large to be visualized. <code>plot_prox</code> takes a principal components decomposition of this matrix using <code>prcomp</code>, and plots it using a biplot. Additional arguments allow other covariates to be mapped onto the size of the points, their color (shown), or their shape.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Species ~<span class="st"> </span>., iris, <span class="dt">proximity =</span> <span class="ot">TRUE</span>)
prox &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract_proximity.html">extract_proximity</a></span>(fit)
pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(prox, <span class="dt">scale =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/plot_prox.html">plot_prox</a></span>(pca, <span class="dt">color =</span> iris$Species, <span class="dt">color_label =</span> <span class="st">"Species"</span>, <span class="dt">size =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<p>The function <code>plot_pred</code> makes plots of predictions versus observations and has the additional feature of being able to &ldquo;tag&rdquo; outliers, and assign them labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(hp ~<span class="st"> </span>., mtcars)
pred &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata =</span> mtcars, <span class="dt">OOB =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/plot_pred.html">plot_pred</a></span>(pred, mtcars$hp,
           <span class="dt">outlier_idx =</span> <span class="kw">which</span>(<span class="kw">abs</span>(pred -<span class="st"> </span>mtcars$hp) &gt;<span class="st"> </span>.<span class="dv">5</span> *<span class="st"> </span><span class="kw">sd</span>(mtcars$hp)),
           <span class="dt">labs =</span> <span class="kw">row.names</span>(mtcars))</code></pre></div>
<p><img src="edarf_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
  </div>

  <div class="col-md-3 hidden-xs">
      </div>

</div>


      <footer><p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer></div>

  </body></html>
